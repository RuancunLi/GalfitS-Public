

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Appendix &mdash; GalfitS Public 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=0d344481"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API Reference" href="api_reference.html" />
    <link rel="prev" title="Analyze the Output of GalfitS" href="analyze.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            GalfitS
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start to GalfitS Everything</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_preparation.html">Prepare Data for GalfitS</a></li>
<li class="toctree-l1"><a class="reference internal" href="config_intro.html">Introduction to GalfitS Config Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="config_example.html">Examples of Config Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="rungs.html">Run GalfitS</a></li>
<li class="toctree-l1"><a class="reference internal" href="analyze.html">Analyze the Output of GalfitS</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Appendix</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#star-formation-history-in-galfits">Star Formation History in GalfitS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setting-sfh-model">Setting SFH Model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#burst-and-continuous-sfh">Burst and Continuous SFH</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bins-sfh">Bins SFH</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#visualizing-sfh-results">Visualizing SFH Results</a></li>
<li class="toctree-l3"><a class="reference internal" href="#constraining-sfh-through-priors">Constraining SFH through Priors</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#run-galfits-on-galaxy-sample">Run GalfitS on galaxy sample</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#running-galfits-in-parallel-with-mpi">Running GalfitS in Parallel with MPI</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api_reference.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">GalfitS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Appendix</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/appendix.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="appendix">
<h1>Appendix<a class="headerlink" href="#appendix" title="Link to this heading"></a></h1>
<section id="star-formation-history-in-galfits">
<h2>Star Formation History in GalfitS<a class="headerlink" href="#star-formation-history-in-galfits" title="Link to this heading"></a></h2>
<section id="setting-sfh-model">
<h3>Setting SFH Model<a class="headerlink" href="#setting-sfh-model" title="Link to this heading"></a></h3>
<p>In GalfitS, each profile (e.g., bulge, disk, spiral arms) can be assigned a distinct star formation history (SFH). GalfitS supports three types of SFH for each profile: <strong>burst</strong>, <strong>continuous (conti)</strong>, and <strong>bins</strong>. The type of SFH is specified in the 15th parameter of the profile configuration, as shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Pa15) bins  # star formation history type: burst/conti/bins
</pre></div>
</div>
<section id="burst-and-continuous-sfh">
<h4>Burst and Continuous SFH<a class="headerlink" href="#burst-and-continuous-sfh" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p><strong>Burst SFH</strong>: Represents a recent starburst event. It consists of a stellar population with a constant star formation rate (SFR) over the last 100 Myr, combined with a single stellar population (SSP) that approximates the galaxy’s mass-building phase at a specific burst age.</p></li>
<li><p><strong>Continuous SFH</strong>: Models a more gradual star formation process, with a constant SFR starting from 200 Myr after the Big Bang, plus an SSP representing an older burst.</p></li>
</ul>
<p>These SFH types are illustrated in the figure below, which compares them to other common SFH models like double exponential and delayed-tau models used in CIGALE.</p>
<figure class="align-center" id="id1">
<img alt="_images/sfh_burst_conti.png" src="_images/sfh_burst_conti.png" />
<figcaption>
<p><span class="caption-text">Example of bursty (burst) and continuous SFH (conti) in GalfitS, and their comparison with double exponential (sfh2exp) and delayed tau SFH (sfhdelayed) in CIGALE. The dashed curves represent the sfh2exp (in red) and sfhdelayed (in blue) models, with the vertical dashed line indicating the weighted stellar age (<span class="math notranslate nohighlight">\(\bar{t}\)</span>, Equation 19). The parameters for these curves are randomly sampled as in Section 4.1.2. The solid curves show the SFHs recovered by fitting mock photometric data points generated based on the SFHs of the dashed curves, using the burst (red) and conti (blue) models in GalfitS, respectively. This approach demonstrates a good agreement in the shape of the input (dashed curves) and output (solid curves) SFHs. The fitted values of <span class="math notranslate nohighlight">\(\bar{t}\)</span>, marked by stars on the graph, also closely match the input values.</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="bins-sfh">
<h4>Bins SFH<a class="headerlink" href="#bins-sfh" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p><strong>Bins SFH</strong>: A more flexible approach where the SFH is divided into discrete time bins, each with a constant SFR. The SFR in each bin is controlled by the 9th parameter (<code class="docutils literal notranslate"><span class="pre">Pa9</span></code>), and the ages of the bins are defined by the 10th parameter (<code class="docutils literal notranslate"><span class="pre">Pa10</span></code>). The bins must be ordered from most recent (first bin, typically at 0 Gyr) to oldest (last bin).</p></li>
</ul>
<p>The three SFH types have distinct functional shapes and are controlled by the 9th and 10th parameters. Examples of their configurations are provided below:</p>
<ul>
<li><p><strong>For Burst SFH</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Pa9) [[-1,-4,0,0.1,1]]  # contemporary log star formation fraction
Pa10) [[5,0.01,10,0.1,1]]  # burst stellar age [Gyr]
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Pa9</span></code>: Logarithm of the fraction of stellar mass formed in the last 100 Myr.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Pa10</span></code>: Look-back time (age) of the SSP representing the burst.</p></li>
</ul>
</li>
<li><p><strong>For Continuous SFH</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Pa9) [[-1,-4,0,0.1,1]]  # contemporary log star formation fraction
Pa10) [[5,0.01,10,0.1,1]]  # burst stellar age [Gyr]
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Pa9</span></code>: Logarithm of the fraction of stellar mass formed since 200 Myr after the Big Bang.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Pa10</span></code>: Age of the SSP burst.</p></li>
</ul>
</li>
<li><p><strong>For Bins SFH</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Pa9) [[-2,-8,0,0.1,1],[-2,-8,0,0.1,1],[-2,-8,0,0.1,1],[-2,-8,0,0.1,1],[-1,-8,0,0.1,0]]  # logMass_fraction formed at each time bin
Pa10) [0.,0.1,0.5,1.5,3,13.6]  # age time bins [Gyr]
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Pa9</span></code>: Logarithm of the stellar mass fraction formed in each bin (length: number of bins). The last fraction is typically fixed to avoid degeneracy.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Pa10</span></code>: Look-back ages defining the bin edges (length: number of bins + 1), ranging from 0 Gyr (most recent) to the oldest age (e.g., 13.6 Gyr).</p></li>
</ul>
</li>
</ul>
<p>The burst and continuous SFHs provide simpler models with fewer parameters, while the bins SFH offers greater flexibility by allowing the user to define custom time intervals and SFRs for a more detailed reconstruction of the galaxy’s star formation history.</p>
</section>
</section>
<section id="visualizing-sfh-results">
<h3>Visualizing SFH Results<a class="headerlink" href="#visualizing-sfh-results" title="Link to this heading"></a></h3>
<p>After fitting, the SFH can be visualized using the following Python code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># The galaxy is at z=0.2691, cosmic age about 10.57 Gyr</span>
<span class="n">pltwave</span><span class="p">,</span> <span class="n">Sedcomp</span><span class="p">,</span> <span class="n">Sedlabel</span><span class="p">,</span> <span class="n">z0</span> <span class="o">=</span> <span class="n">Myfitter</span><span class="o">.</span><span class="n">cal_model_image</span><span class="p">()</span>
<span class="n">modelg</span> <span class="o">=</span> <span class="n">Myfitter</span><span class="o">.</span><span class="n">model_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">times</span><span class="p">,</span> <span class="n">SFHs</span> <span class="o">=</span> <span class="n">modelg</span><span class="o">.</span><span class="n">get_SFH</span><span class="p">()</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">SFHs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Look Back Time (Gyr)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;SFR (M$_\odot$/yr)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>The resulting plot displays the star formation rate (SFR) as a function of look-back time:</p>
<figure class="align-center">
<img alt="_images/sfh1.png" src="_images/sfh1.png" />
</figure>
</section>
<section id="constraining-sfh-through-priors">
<h3>Constraining SFH through Priors<a class="headerlink" href="#constraining-sfh-through-priors" title="Link to this heading"></a></h3>
<p>The star formation history can be further constrained by setting astrophysical priors in the prior file. These priors impose functional forms on the SFH, such as exponential or delayed-tau models, and are particularly useful for the bins SFH type. Below are examples of how to set priors for different SFH functional forms:</p>
<ul>
<li><p><strong>Exponential Increase</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># For exponential increase: SFR(t) = SFR0 * exp((t - t0) / tau)
SFHa1) total
SFHa2) exponential
SFHa3) [[1.,-0.5,2,0.1,1],[0.15,-0.2,0.6,0.1,1],[0.65,0.,1.3,0.1,1]]
SFHa4) [[1.04,0.16],[0.15,0.04],[0.65,0.18]]
</pre></div>
</div>
</li>
<li><p><strong>Delayed Tau</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># For delayed tau: SFR(t) = SFR0 * (t / tau^2) * exp(-t / tau)
SFHa1) total
SFHa2) delayed
SFHa3) [[1.,-0.5,2,0.1,1],[0.15,-0.2,0.6,0.1,1]]
SFHa4) [[1.04,0.16],[0.15,0.04]]
</pre></div>
</div>
</li>
<li><p><strong>Double Exponential</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># For double exponential: SFR(t) = SFR0 * (exp((t - t0) / tau0) - k * exp((t - t1) / tau1))
SFHa1) total
SFHa2) exponential2
SFHa3) [[0.4,-0.5,2,0.1,0],[0.15,-0.2,0.6,0.1,1],[0.65,0.,1.3,0.1,1],[0.15,-0.2,0.6,0.1,1],[0.65,0.,1.3,0.1,1]]
SFHa4) [[1],[],[],[],[]]
</pre></div>
</div>
</li>
</ul>
<p>In this model, the star formation rate (SFR) is modeled as the sum of two exponential components:
one representing the older population and one representing a recent burst. The model
parameters are given as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">logSFR0</span></code>: The logarithm of the normalization of the SFR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tau0</span></code>: The exponential timescale for the older population.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">f</span></code>: The fraction of the stellar mass coming from the recent burst.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tau1</span></code>: The exponential timescale for the recent burst.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">t1</span></code>: The onset time of the recent burst.</p></li>
</ul>
<p>The double exponential SFH is defined by</p>
<div class="math notranslate nohighlight">
\[\mathrm{SFR}(t) = \mathrm{SFR0} \left(\exp\Bigl(\frac{t-t_0}{\tau_0}\Bigr) + k\,\exp\Bigl(\frac{t-t_1}{\tau_1}\Bigr)\right),\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(t\)</span> is the cosmic time.</p></li>
<li><p><span class="math notranslate nohighlight">\(t_0\)</span> is the age of the Universe (by default, the present time).</p></li>
<li><p>The first term models the older stellar population.</p></li>
<li><p>The second term models the recent burst.</p></li>
</ul>
<p>Here, <span class="math notranslate nohighlight">\(f\)</span> is defined as the fraction of stellar mass formed in the recent burst, and
<span class="math notranslate nohighlight">\(k\)</span> is the amplitude scaling the burst contribution in the SFR. To derive the relationship,
we integrate each exponential term over time.</p>
<p>By definition <span class="math notranslate nohighlight">\(f\)</span> is the burst stellar mass fraction then by definition</p>
<div class="math notranslate nohighlight">
\[f = \frac{M_{\rm burst}}{M_{\rm old} + M_{\rm burst}}.\]</div>
<p>We can solve <span class="math notranslate nohighlight">\(k\)</span> based on <span class="math notranslate nohighlight">\(f\)</span> :</p>
<div class="math notranslate nohighlight">
\[k = \frac{f\,\tau_0\Bigl(1 - \exp\Bigl(-\frac{t_0}{\tau_0}\Bigr)\Bigr)}
         {(1-f)\,\tau_1\Bigl(1 - \exp\Bigl(-\frac{t_1}{\tau_1}\Bigr)\Bigr)}.\]</div>
<p>This expression converts the burst stellar mass fraction <span class="math notranslate nohighlight">\(f\)</span> into the amplitude <span class="math notranslate nohighlight">\(k\)</span>
for the recent burst term.</p>
<p>These priors are applied only when the SFH type is set to <code class="docutils literal notranslate"><span class="pre">bins</span></code> in the configuration file. For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Pa9) [[0,-8,8,0.1,0],[0,-8,8,0.1,0],[0,-8,8,0.1,0],[0,-8,8,0.1,0],[0,-8,8,0.1,0],[0,-8,8,0.1,0],[0,-8,8,0.1,0],[0,-8,8,0.1,0],[0,-8,8,0.1,0],[0,-8,8,0.1,0],[0,-8,8,0.1,0],[0,-8,8,0.1,0]]  # logMass_fraction formed at each time bin
Pa10) [0.,0.033,0.05681831,0.09782788,0.16843678,0.29000887,0.4993277,0.85972583,1.4802471,2.5486407,4.3881655,7.5553966,13.008631]  # age time bins [Gyr]
...
Pa15) bins
</pre></div>
</div>
<p>Using more bins improves the resolution of the SFH. An example of a double exponential SFH fit is shown below:</p>
<figure class="align-center">
<img alt="_images/sfh2.jpg" src="_images/sfh2.jpg" />
</figure>
<p>In principle, the normalization parameter (e.g., SFR0) is degenerate with the stellar mass. However, when the prior in <code class="docutils literal notranslate"><span class="pre">SFHa4</span></code> has a length greater than zero for the first element (i.e., <code class="docutils literal notranslate"><span class="pre">len(SFHa4)[0]</span> <span class="pre">&gt;</span> <span class="pre">0</span></code>), it incorporates a constraint on the recent SFR, fitting it to a specific value (e.g., the most recent SFR in the above figure).</p>
</section>
</section>
<section id="run-galfits-on-galaxy-sample">
<h2>Run GalfitS on galaxy sample<a class="headerlink" href="#run-galfits-on-galaxy-sample" title="Link to this heading"></a></h2>
<p>To run GalfitS on a sample of galaxies, you first need to generate configuration files for each galaxy. These config files specify the parameters and data files for the fitting process. For details on the configuration file format, see <span class="xref std std-ref">config_example</span>.</p>
<p>For instance, if you want to perform SED analysis using the config in <a class="reference external" href="https://github.com/RuancunLi/GalfitS-Public/tree/main/examples/SEDfit.lyric">SEDfit.lyric</a>, you can use the following Python script to generate config files for all galaxies in your sample:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.table</span><span class="w"> </span><span class="kn">import</span> <span class="n">Table</span>

<span class="c1"># Load the galaxy sample</span>
<span class="n">sample</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;galaxy_sample.txt&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
<span class="n">outpath</span> <span class="o">=</span> <span class="s1">&#39;./configs/&#39;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outpath</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">outpath</span><span class="p">)</span>

<span class="n">standard_config</span> <span class="o">=</span> <span class="s1">&#39;./phot.lyric&#39;</span>
<span class="n">imgpath</span> <span class="o">=</span> <span class="s1">&#39;/path/to/your/photometric_data/&#39;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">standard_config</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">standard</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">galaxy</span> <span class="ow">in</span> <span class="n">sample</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">galaxy</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">ra</span> <span class="o">=</span> <span class="n">galaxy</span><span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">]</span>
        <span class="n">dec</span> <span class="o">=</span> <span class="n">galaxy</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">]</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">galaxy</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>
        <span class="n">outname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outpath</span><span class="p">,</span> <span class="s1">&#39;SEDfit_2exp.lyric&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">liindex</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">standard</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">liindex</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">fobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;R1) </span><span class="si">{0}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">liindex</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="n">fobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;R2) [</span><span class="si">{0}</span><span class="s2">,</span><span class="si">{1}</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">liindex</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                    <span class="n">fobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;R3) </span><span class="si">{0}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">liindex</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
                    <span class="n">img</span> <span class="o">=</span> <span class="n">imgpath</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;band1.fits&#39;</span>
                    <span class="n">fobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Ia1) [</span><span class="si">{0}</span><span class="s2">,0]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">img</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">liindex</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
                    <span class="n">img</span> <span class="o">=</span> <span class="n">imgpath</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;band1.fits&#39;</span>
                    <span class="n">fobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Ia3) [</span><span class="si">{0}</span><span class="s2">,2]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">img</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">liindex</span> <span class="o">==</span> <span class="mi">13</span><span class="p">:</span>
                    <span class="n">img</span> <span class="o">=</span> <span class="n">imgpath</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;band1.fits&#39;</span>
                    <span class="n">fobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Ia4) [</span><span class="si">{0}</span><span class="s2">,3]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">img</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="n">standard</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Reset file pointer for next galaxy</span>
</pre></div>
</div>
<p>This script reads a standard config file and, for each galaxy in the sample, creates a new config file by modifying specific lines with the galaxy’s name, coordinates (RA and Dec), redshift (z), and paths to the photometric image files. The full script can be found in <a class="reference external" href="https://github.com/RuancunLi/GalfitS-Public/tree/main/examples/write_configs.py">write_configs.py</a>.</p>
<section id="running-galfits-in-parallel-with-mpi">
<h3>Running GalfitS in Parallel with MPI<a class="headerlink" href="#running-galfits-in-parallel-with-mpi" title="Link to this heading"></a></h3>
<p>Once you have generated the configuration files for all galaxies in your sample, you can run GalfitS on each config file. For large samples, it is efficient to parallelize the fitting using <cite>mpi4py</cite>. Below is an example script that distributes the config files across available MPI processes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">astropy.table</span><span class="w"> </span><span class="kn">import</span> <span class="n">Table</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mpi4py</span><span class="w"> </span><span class="kn">import</span> <span class="n">MPI</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="n">comm</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>
<span class="n">rank</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">Get_rank</span><span class="p">()</span>
<span class="n">size</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">Get_size</span><span class="p">()</span>

<span class="n">sample</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;./gs_test.txt&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
<span class="n">loop</span> <span class="o">=</span> <span class="n">rank</span>  <span class="c1"># Start from rank to distribute tasks correctly</span>
<span class="n">stop</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
<span class="k">while</span> <span class="n">loop</span> <span class="o">&lt;</span> <span class="n">stop</span><span class="p">:</span>
    <span class="n">tagname</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">][</span><span class="n">loop</span><span class="p">]</span>
    <span class="n">dic</span> <span class="o">=</span> <span class="s1">&#39;./result/</span><span class="si">{0}</span><span class="s1">/&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tagname</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dic</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dic</span><span class="p">)</span>
    <span class="n">config_file</span> <span class="o">=</span> <span class="s1">&#39;./configs/SEDfit_2exp.lyric&#39;</span>  <span class="c1"># Match config name from generation</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;CUDA_VISIBLE_DEVICES=</span><span class="si">{0}</span><span class="s1"> python galfitS.py --config </span><span class="si">{1}</span><span class="s1"> --work ./2com --num_s 15000&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span> <span class="n">config_file</span><span class="p">)</span>
    <span class="n">proc</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">dic</span><span class="p">)</span>
    <span class="n">proc</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
    <span class="n">loop</span> <span class="o">+=</span> <span class="n">size</span>
</pre></div>
</div>
<p>To run this script, use the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>python<span class="w"> </span>galfitS_mpi.py
</pre></div>
</div>
<p>This command runs the script on 4 processes, each potentially using a different GPU if available, with each process handling a subset of the galaxies in the sample.</p>
<p>If you have a limited number of GPUs, you can modify the script to run on the CPU by removing the <code class="docutils literal notranslate"><span class="pre">CUDA_VISIBLE_DEVICES</span></code> setting:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;python galfitS.py --config </span><span class="si">{0}</span><span class="s1"> --work ./2com --num_s 15000&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively, you can specify specific GPU IDs, e.g., <code class="docutils literal notranslate"><span class="pre">CUDA_VISIBLE_DEVICES=0,1,2,3</span></code>, or set <code class="docutils literal notranslate"><span class="pre">OMP_NUM_THREADS</span></code> for multi-threading on the CPU. Refer to the GalfitS documentation for detailed instructions on CPU execution.</p>
<p>Note: Ensure that <code class="docutils literal notranslate"><span class="pre">galfitS.py</span></code> is in your PATH or provide the full path in the command. The options <code class="docutils literal notranslate"><span class="pre">--work</span> <span class="pre">./2com</span> <span class="pre">--num_s</span> <span class="pre">15000</span></code> are example-specific and should be adjusted according to your requirements.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="analyze.html" class="btn btn-neutral float-left" title="Analyze the Output of GalfitS" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="api_reference.html" class="btn btn-neutral float-right" title="API Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Li R. &amp; Ho C. Luis.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>